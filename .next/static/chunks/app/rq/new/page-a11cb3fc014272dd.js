(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[277],{1835:function(e,s,r){Promise.resolve().then(r.bind(r,525))},525:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return b}});var t=r(8947),a=r(3081),o=r(2810),l=r(4790),i=r(5375);r(8072);var n=r(6858);(0,n.$)("ac057b67b8b1ae4ea4b2341eb2557edca55a89da");var d=(0,n.$)("52c16ba36866f980f8fb2cacbff22d8ec74d1c5b"),c=r(9045),m=r(6834),x=r(1518);let u=i.Ry({name:i.Z_().min(1,"Requerido"),spec:i.Z_().optional(),qty:i.Rx().positive("> 0"),uom:i.Z_().optional()}),p=i.Ry({projectId:i.Z_().min(1,"Selecciona un proyecto"),costCenterId:i.Z_().optional(),title:i.Z_().min(3),description:i.Z_().optional(),items:i.IX(u).min(1,"Agrega al menos 1 \xedtem")});function b(){let e=(0,m.useRouter)(),s=(0,o.cI)({resolver:(0,l.F)(p),defaultValues:{items:[{name:"",spec:"",qty:1,uom:"unidad"}]}}),{fields:r,append:i,remove:n}=(0,o.Dq)({name:"items",control:s.control}),[u,b]=(0,a.useState)([]),[h,f]=(0,a.useState)([]),[g,j]=(0,a.useState)(!1);async function N(r){j(!0);try{let t={projectId:r.projectId,costCenterId:r.costCenterId||void 0,title:r.title,description:r.description||"",items:r.items.map(e=>({name:e.name,spec:e.spec||"",qty:Number(e.qty),uom:e.uom||"unidad"}))},a=await d(t);alert("RQ creada exitosamente: ".concat(a.code)),s.reset(),e.push("/dashboard?role=SOLICITANTE")}catch(e){console.error("Error creating RQ:",e),alert("Error al crear la RQ")}finally{j(!1)}}return(0,a.useEffect)(()=>{fetch("/api/catalogs").then(e=>e.json()).then(e=>{b(e.projects),f(e.costCenters)})},[]),(0,t.jsx)(c.default,{currentRole:"SOLICITANTE",children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("header",{className:"rounded-3xl bg-gradient-to-r from-blue-500 via-blue-600 to-indigo-500 p-8 text-white shadow-lg",children:(0,t.jsxs)("div",{className:"flex flex-col gap-6 md:flex-row md:items-end md:justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.4em] text-white/70",children:"Solicitante"}),(0,t.jsx)("h1",{className:"mt-2 text-3xl font-bold leading-tight",children:"Crear nueva requisici\xf3n"}),(0,t.jsx)("p",{className:"mt-2 max-w-2xl text-sm text-white/80",children:"Completa la informaci\xf3n del proyecto y los \xedtems requeridos. Una vez enviada, compras recibir\xe1 una alerta para iniciar el proceso de cotizaci\xf3n."})]}),(0,t.jsx)("div",{className:"rounded-2xl bg-white/10 px-4 py-3 text-xs uppercase tracking-widest text-white/80 shadow backdrop-blur",children:"Tiempo estimado: 5 minutos"})]})}),(0,t.jsxs)("div",{className:"grid gap-6 lg:grid-cols-[2fr_1fr] max-w-full overflow-x-hidden",children:[(0,t.jsxs)("div",{className:"rounded-3xl border border-slate-200 bg-white p-6 sm:p-8 shadow-sm min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-semibold text-slate-900",children:"Informaci\xf3n de la solicitud"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-slate-500",children:"Los campos marcados con * son obligatorios."})]}),(0,t.jsx)("button",{type:"button",onClick:()=>s.reset(),className:"rounded-full border border-slate-200 px-4 py-2 text-xs font-semibold text-slate-600 transition hover:border-blue-400 hover:text-blue-600",children:"Limpiar formulario"})]}),(0,t.jsxs)("form",{onSubmit:s.handleSubmit(N),className:"mt-6 space-y-6 min-w-0",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"projectId",className:"block text-sm font-medium text-gray-700 mb-2",children:"Proyecto *"}),(0,t.jsxs)("select",{id:"projectId",className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",...s.register("projectId"),children:[(0,t.jsx)("option",{value:"",children:"Selecciona un proyecto..."}),u.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]}),s.formState.errors.projectId&&(0,t.jsx)("p",{className:"text-red-600 text-sm mt-1",children:s.formState.errors.projectId.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"costCenterId",className:"block text-sm font-medium text-gray-700 mb-2",children:"Centro de Costo (opcional)"}),(0,t.jsxs)("select",{id:"costCenterId",className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",...s.register("costCenterId"),children:[(0,t.jsx)("option",{value:"",children:"Seleccionar..."}),h.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-2",children:"T\xedtulo *"}),(0,t.jsx)("input",{type:"text",id:"title",className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ej. Compra de bolsas para quir\xf3fano",...s.register("title")}),s.formState.errors.title&&(0,t.jsx)("p",{className:"text-red-600 text-sm mt-1",children:s.formState.errors.title.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-2",children:"Descripci\xf3n"}),(0,t.jsx)("textarea",{id:"description",className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3,placeholder:"Descripci\xf3n detallada de la requisici\xf3n...",...s.register("description")})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"\xcdtems de la Requisici\xf3n"}),(0,t.jsx)("button",{type:"button",className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-md text-sm font-medium transition-colors",onClick:()=>i({name:"",spec:"",qty:1,uom:"unidad"}),children:"+ Agregar \xcdtem"})]}),(0,t.jsx)("div",{className:"space-y-4",children:r.map((e,a)=>{var o,l,i,d,c,m,x,u;return(0,t.jsxs)("div",{className:"grid grid-cols-12 gap-3 p-4 border border-gray-200 rounded-lg min-w-0",children:[(0,t.jsxs)("div",{className:"col-span-12 sm:col-span-4 min-w-0",children:[(0,t.jsx)("label",{htmlFor:"".concat(e.id,"-name"),className:"block text-xs font-medium text-gray-500 mb-1",children:"Nombre del Producto *"}),(0,t.jsx)("input",{id:"".concat(e.id,"-name"),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Nombre del producto",...s.register("items.".concat(a,".name"))}),(null===(l=s.formState.errors.items)||void 0===l?void 0:null===(o=l[a])||void 0===o?void 0:o.name)&&(0,t.jsx)("p",{className:"text-red-600 text-xs mt-1",children:null===(d=s.formState.errors.items[a])||void 0===d?void 0:null===(i=d.name)||void 0===i?void 0:i.message})]}),(0,t.jsxs)("div",{className:"col-span-12 sm:col-span-4 min-w-0",children:[(0,t.jsx)("label",{htmlFor:"".concat(e.id,"-spec"),className:"block text-xs font-medium text-gray-500 mb-1",children:"Especificaci\xf3n"}),(0,t.jsx)("input",{id:"".concat(e.id,"-spec"),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Especificaciones t\xe9cnicas",...s.register("items.".concat(a,".spec"))})]}),(0,t.jsxs)("div",{className:"col-span-6 sm:col-span-2 min-w-0",children:[(0,t.jsx)("label",{htmlFor:"".concat(e.id,"-qty"),className:"block text-xs font-medium text-gray-500 mb-1",children:"Cantidad *"}),(0,t.jsx)("input",{type:"number",min:"0.01",step:"0.01",id:"".concat(e.id,"-qty"),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",...s.register("items.".concat(a,".qty"),{valueAsNumber:!0})}),(null===(m=s.formState.errors.items)||void 0===m?void 0:null===(c=m[a])||void 0===c?void 0:c.qty)&&(0,t.jsx)("p",{className:"text-red-600 text-xs mt-1",children:null===(u=s.formState.errors.items[a])||void 0===u?void 0:null===(x=u.qty)||void 0===x?void 0:x.message})]}),(0,t.jsxs)("div",{className:"col-span-5 sm:col-span-1 min-w-0",children:[(0,t.jsx)("label",{htmlFor:"".concat(e.id,"-uom"),className:"block text-xs font-medium text-gray-500 mb-1",children:"Unidad"}),(0,t.jsx)("input",{id:"".concat(e.id,"-uom"),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ej: unidad",...s.register("items.".concat(a,".uom"))})]}),(0,t.jsx)("div",{className:"col-span-1 flex items-end",children:(0,t.jsx)("button",{type:"button",className:"w-full border border-red-300 text-red-600 rounded-md px-2 py-2 hover:bg-red-50 transition-colors",onClick:()=>n(a),disabled:1===r.length,children:(0,t.jsx)("svg",{className:"w-4 h-4 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})})]},e.id)})}),s.formState.errors.items&&(0,t.jsx)("p",{className:"text-red-600 text-sm mt-2",children:s.formState.errors.items.message})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-4 pt-6 border-t border-gray-200",children:[(0,t.jsx)("button",{type:"button",onClick:()=>e.push("/dashboard?role=SOLICITANTE"),className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 font-medium",children:"Cancelar"}),(0,t.jsx)("button",{type:"submit",disabled:g,className:"px-6 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed font-medium",children:g?"Creando...":"Crear Requisici\xf3n"})]})]})]}),(0,t.jsxs)("aside",{className:"space-y-4 min-w-0",children:[(0,t.jsxs)("div",{className:"rounded-3xl border border-slate-200 bg-white p-5 sm:p-6 shadow-sm",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold uppercase tracking-widest text-slate-500",children:"Flujo de aprobaci\xf3n"}),(0,t.jsx)("p",{className:"mt-2 text-xs text-slate-500",children:"Tu requisici\xf3n se enviar\xe1 autom\xe1ticamente a Compras. Desde all\xed se generar\xe1n cotizaciones, comparativos y autorizaciones seg\xfan el flujo institucional."}),(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)(x.N,{currentStatus:"ENVIADA_COMPRAS",compact:!0})})]}),(0,t.jsxs)("div",{className:"rounded-3xl border border-blue-100 bg-blue-50 p-5 sm:p-6 text-sm text-blue-900 shadow-sm",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold uppercase tracking-widest text-blue-700",children:"Tips r\xe1pidos"}),(0,t.jsxs)("ul",{className:"mt-3 space-y-2",children:[(0,t.jsxs)("li",{className:"flex items-start gap-2",children:[(0,t.jsx)("svg",{className:"mt-1 h-4 w-4 flex-shrink-0 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Detalla las especificaciones para facilitar la cotizaci\xf3n."]}),(0,t.jsxs)("li",{className:"flex items-start gap-2",children:[(0,t.jsx)("svg",{className:"mt-1 h-4 w-4 flex-shrink-0 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Incluye cantidades exactas y unidades de medida."]}),(0,t.jsxs)("li",{className:"flex items-start gap-2",children:[(0,t.jsx)("svg",{className:"mt-1 h-4 w-4 flex-shrink-0 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Adjunta notas especiales si el \xedtem requiere entrega programada."]})]})]})]})]})]})})}},1518:function(e,s,r){"use strict";r.d(s,{N:function(){return l}});var t=r(8947),a=r(1960),o=r(3537);function l(e){let{currentStatus:s,compact:r=!1}=e,l=(0,o.Pe)(),i=function(e){if(!e)return -1;let s=e.toUpperCase(),r=o.bW.indexOf(s);return r>=0?r:"RECHAZADA"===s?o.bW.indexOf("EN_AUTORIZACION"):-1}(s),n=(null==s?void 0:s.toUpperCase())==="RECHAZADA";return(0,t.jsxs)("div",{className:(0,a.Z)("space-y-4",r&&"space-y-2"),children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-gray-700",children:"Flujo del proceso"}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:s?"Estado actual: ".concat(s.replace(/_/g," ")):"Sin estado asignado"})]}),0===l.length?(0,t.jsxs)("span",{className:"inline-flex items-center gap-1 text-xs font-medium text-green-700 bg-green-100 px-2 py-1 rounded-full",children:[(0,t.jsx)("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Flujo validado"]}):(0,t.jsxs)("span",{className:"inline-flex items-center gap-1 text-xs font-medium text-red-700 bg-red-100 px-2 py-1 rounded-full",children:[(0,t.jsx)("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01M12 5a7 7 0 100 14 7 7 0 000-14z"})}),"Flujo requiere ajustes"]})]}),(0,t.jsx)("div",{className:(0,a.Z)("max-w-full overflow-x-auto pb-1 [-ms-overflow-style:none] [scrollbar-width:none] [&::-webkit-scrollbar]:hidden"),children:(0,t.jsx)("div",{className:(0,a.Z)("relative flex flex-col md:flex-row md:flex-wrap",r?"gap-3 md:gap-4":"gap-4 md:gap-6"),children:o.bW.map((e,s)=>{let l=o.A9[e],d=i>s,c=i===s&&!n;return(0,t.jsxs)("div",{className:(0,a.Z)("flex-1 min-w-[140px] md:flex-[1_1_180px]"),children:[(0,t.jsxs)("div",{className:(0,a.Z)("flex items-center gap-3 rounded-2xl border px-4 py-3 shadow-sm transition-colors",c&&"border-blue-500 bg-blue-50 text-blue-900 shadow",d&&!c&&"border-green-500 bg-green-50 text-green-900",!c&&!d&&"border-gray-200 bg-white text-gray-600"),children:[(0,t.jsx)("div",{className:(0,a.Z)("flex h-10 w-10 items-center justify-center rounded-full border-2 text-sm font-semibold",c&&"border-blue-500 bg-blue-100 text-blue-700",d&&!c&&"border-green-500 bg-green-100 text-green-700",!c&&!d&&"border-gray-200 bg-gray-100 text-gray-500"),children:s+1}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wider",children:l.label}),(0,t.jsx)("span",{className:"text-[11px] text-gray-500",children:l.actor})]})]}),(0,t.jsx)("p",{className:(0,a.Z)("mt-2 text-xs leading-relaxed text-gray-500",r&&"hidden md:block"),children:l.description}),n&&"EN_AUTORIZACION"===e&&(0,t.jsxs)("div",{className:"mt-2 inline-flex items-center gap-2 rounded-lg border border-red-200 bg-red-50 px-3 py-2 text-xs text-red-700",children:[(0,t.jsx)("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18.364 5.636a9 9 0 11-12.728 0 9 9 0 0112.728 0zM9 9l6 6m0-6l-6 6"})}),"Rechazada - volver a Compras"]})]},e)})})}),l.length>0&&(0,t.jsxs)("div",{className:"rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-xs text-red-700",children:[(0,t.jsx)("p",{className:"font-semibold mb-1",children:"Inconsistencias detectadas en el workflow:"}),(0,t.jsx)("ul",{className:"list-disc pl-5 space-y-1",children:l.map(e=>(0,t.jsx)("li",{children:e},e))})]})]})}}},function(e){e.O(0,[747,687,75,45,580,996,744],function(){return e(e.s=1835)}),_N_E=e.O()}]);